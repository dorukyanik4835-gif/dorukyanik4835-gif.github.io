<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hava Kalite Ä°stasyonu</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg,#2d89ef,#1b5fa7);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}

.container {
    background: white;
    width: 380px;
    padding: 25px;
    border-radius: 20px;
    box-shadow: 0 15px 30px rgba(0,0,0,0.25);
}

h1 {
    text-align: center;
    margin-top: 0;
    color: #2d89ef;
}

.section {
    margin-bottom: 25px;
}

.gaz {
    font-size: 28px;
    font-weight: bold;
    text-align: center;
}

.durum {
    text-align: center;
    font-weight: bold;
    margin-top: 5px;
}

button {
    width: 100%;
    padding: 10px;
    margin-top: 8px;
    border: none;
    border-radius: 10px;
    background: #2d89ef;
    color: white;
    font-size: 14px;
    cursor: pointer;
}

button:hover {
    background: #1b5fa7;
}

.temizlik {
    margin-top: 40px; /* aÅŸaÄŸÄ±ya aldÄ±k */
    border-top: 1px solid #ddd;
    padding-top: 20px;
}

.kayitlar {
    max-height: 120px;
    overflow-y: auto;
    font-size: 13px;
    margin-top: 10px;
}
</style>
</head>

<body>

<div class="container">

    <h1>ğŸŒ¬ï¸ Hava Kalite Ä°stasyonu</h1>

    <!-- HAVA KALÄ°TESÄ° -->
    <div class="section">
        <div class="gaz">
            <span id="gaz">--</span>
        </div>
        <div class="durum" id="durum">BaÄŸlantÄ± Bekleniyor...</div>
        <button onclick="baglan()">Arduino BaÄŸlan</button>
    </div>

    <!-- TEMÄ°ZLÄ°K -->
    <div class="temizlik">
        <h3>ğŸ§¼ Temizlik KaydÄ±</h3>
        <p><strong>Son Temizlik:</strong></p>
        <p id="sonTemizlik">HenÃ¼z yapÄ±lmadÄ±</p>

        <button onclick="temizlikKaydet('Domestos')">Domestos</button>
        <button onclick="temizlikKaydet('Cif')">Cif</button>
        <button onclick="temizlikKaydet('Mr. Muscle')">Mr. Muscle</button>
        <button onclick="temizlikKaydet('Bingo')">Bingo</button>

        <div class="kayitlar" id="liste"></div>
    </div>

</div>

<script>

let port;
let reader;

async function baglan() {
    try {
        port = await navigator.serial.requestPort();
        await port.open({ baudRate: 9600 });

        const decoder = new TextDecoderStream();
        port.readable.pipeTo(decoder.writable);
        reader = decoder.readable.getReader();

        document.getElementById("durum").innerText = "BaÄŸlandÄ± âœ…";

        while (true) {
            const { value, done } = await reader.read();
            if (done) break;
            if (value) {
                gazGuncelle(parseInt(value));
            }
        }
    } catch (err) {
        alert("BaÄŸlantÄ± hatasÄ±!");
    }
}

function gazGuncelle(deger) {
    document.getElementById("gaz").innerText = deger;

    let durum = document.getElementById("durum");

    if (deger <= 250) {
        durum.innerText = "ğŸŸ¢ Hava Temiz";
        durum.style.color = "green";
    }
    else if (deger <= 400) {
        durum.innerText = "ğŸŸ¡ Orta Seviye";
        durum.style.color = "orange";
    }
    else {
        durum.innerText = "ğŸ”´ Kirli Hava";
        durum.style.color = "red";
    }
}

function temizlikKaydet(marka) {
    const zaman = new Date().toLocaleString("tr-TR");
    document.getElementById("sonTemizlik").innerText = zaman;

    const yeni = document.createElement("div");
    yeni.innerText = zaman + " - " + marka + " ile temizlendi";

    document.getElementById("liste").prepend(yeni);
}

</script>

</body>
</html>
